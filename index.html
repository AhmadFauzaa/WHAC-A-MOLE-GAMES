<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pukul Tikus Tanah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            font-family: 'Fredoka One', sans-serif;
            background-color: #4a90e2;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .container {
            background-color: #3b7bb6;
            padding: 2rem;
            border-radius: 2rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            text-align: center;
            border: 5px solid #2a5a8a;
            max-width: 90%;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            background-color: #6a4f41;
            padding: 1.5rem;
            border-radius: 1.5rem;
            border: 5px solid #4a382e;
            box-shadow: inset 0 5px 10px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .hole {
            width: 100px;
            height: 100px;
            background-color: #8c6a5a;
            border-radius: 50%;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            position: relative;
            overflow: hidden;
            border: 3px solid #6a4f41;
            transition: transform 0.2s;
        }

        .mole {
            font-size: 60px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            position: absolute;
            cursor: pointer;
            text-shadow: none;
        }

        .mole.up {
            transform: translateY(0);
        }
        
        .hammer-cursor {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-hammer"><path d="M15 12l-5 5-3-3 5-5 3 3z"></path><path d="M10 12l4-4M17 19l4-4"></path><path d="M10 12l4-4"></path><path d="M17 19l4-4"></path></svg>') 16 16, auto;
        }
        .shoe-cursor {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-zap"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>') 16 16, auto;
        }

        .btn {
            padding: 0.75rem 2rem;
            font-size: 1.25rem;
            font-weight: bold;
            border-radius: 9999px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .btn-green {
            background-color: #2ecc71;
            color: #fff;
            border-color: #27ae60;
            box-shadow: 0 5px 0 #27ae60;
        }

        .btn-green:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #27ae60;
        }

        .btn-green:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #27ae60;
        }

        .btn-blue {
            background-color: #3498db;
            color: #fff;
            border-color: #2980b9;
            box-shadow: 0 5px 0 #2980b9;
        }

        .btn-blue:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #2980b9;
        }

        .btn-blue:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #2980b9;
        }

        .btn-red {
            background-color: #e74c3c;
            color: #fff;
            border-color: #c0392b;
            box-shadow: 0 5px 0 #c0392b;
        }
        
        .btn-red:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #c0392b;
        }

        .btn-red:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #c0392b;
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #3b7bb6;
            padding: 3rem;
            border-radius: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 1001;
            display: none;
            border: 5px solid #2a5a8a;
        }

        .backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 999;
            display: none;
        }

        .settings-content {
            display: grid;
            gap: 1rem;
            text-align: left;
        }
    </style>
</head>
<body class="hammer-cursor">
    
    <!-- Halaman Awal -->
    <div id="home-screen" class="container">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">Pukul Tikus Tanah</h1>
        <p class="text-lg mb-8">Pukul tikus tanah secepat mungkin!</p>
        <p class="text-xs mb-2 italic">GAME INI DIBUAT OLEH AHMAD FAUZAN DONOT COPY</p>
        <button id="start-game-btn" class="btn btn-green">Mulai Bermain</button>
        <button id="show-settings-btn" class="btn btn-blue mt-4">Pengaturan</button>
    </div>

    <!-- Halaman Pengaturan -->
    <div id="settings-screen" class="container hidden">
        <h2 class="text-3xl font-bold mb-6">Pengaturan Game</h2>
        <div class="settings-content">
            <div>
                <label for="game-level" class="block text-xl mb-2">Pilih Level:</label>
                <select id="game-level" class="w-full p-2 rounded-lg text-black">
                    <option value="1">Mudah</option>
                    <option value="2">Normal</option>
                    <option value="3">Sulit</option>
                </select>
            </div>
            <div>
                <label for="game-duration" class="block text-xl mb-2">Durasi Game (detik):</label>
                <input type="number" id="game-duration" class="w-full p-2 rounded-lg text-black" value="30" min="10" max="120">
            </div>
            <div>
                <label for="game-animal" class="block text-xl mb-2">Pilih Hewan:</label>
                <select id="game-animal" class="w-full p-2 rounded-lg text-black">
                    <option value="🐭">Tikus Tanah</option>
                    <option value="🐰">Kelinci</option>
                    <option value="🐸">Katak</option>
                </select>
            </div>
            <div>
                <label for="game-hammer" class="block text-xl mb-2">Pilih Palu:</label>
                <select id="game-hammer" class="w-full p-2 rounded-lg text-black">
                    <option value="hammer-cursor">Palu</option>
                    <option value="shoe-cursor">Sepatu</option>
                </select>
            </div>
        </div>
        <button id="save-settings-btn" class="btn btn-green mt-8">Simpan</button>
        <button id="back-to-home-btn" class="btn btn-blue mt-4">Kembali</button>
    </div>

    <!-- Halaman Game -->
    <div id="game-screen" class="container hidden">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold">Skor: <span id="score">0</span></h2>
            <div class="flex items-center space-x-4">
                <h2 class="text-3xl font-bold">Waktu: <span id="time-left">30</span></h2>
                <button id="back-to-menu-btn" class="btn btn-blue">Kembali</button>
            </div>
        </div>
        <div class="board" id="game-board">
            <div class="hole"></div>
            <div class="hole"></div>
            <div class="hole"></div>
            <div class="hole"></div>
            <div class="hole"></div>
            <div class="hole"></div>
            <div class="hole"></div>
            <div class="hole"></div>
            <div class="hole"></div>
        </div>
        <button id="reset-game-btn" class="btn btn-red mt-8 hidden">Ulangi Permainan</button>
    </div>

    <!-- Kotak Pesan -->
    <div id="message-box" class="message-box hidden">
        <h3 id="message-title" class="text-2xl font-bold mb-4"></h3>
        <p id="message-content" class="text-lg mb-6"></p>
        <button id="message-close-btn" class="btn btn-red">OK</button>
    </div>
    <div id="backdrop" class="backdrop hidden"></div>

    <script>
        // Getting DOM elements
        const homeScreen = document.getElementById('home-screen');
        const settingsScreen = document.getElementById('settings-screen');
        const gameScreen = document.getElementById('game-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const showSettingsBtn = document.getElementById('show-settings-btn');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const backToHomeBtn = document.getElementById('back-to-home-btn');
        const resetGameBtn = document.getElementById('reset-game-btn');
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        const timeLeftDisplay = document.getElementById('time-left');
        const gameLevelSelect = document.getElementById('game-level');
        const gameDurationInput = document.getElementById('game-duration');
        const gameAnimalSelect = document.getElementById('game-animal');
        const gameHammerSelect = document.getElementById('game-hammer');
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageContent = document.getElementById('message-content');
        const messageCloseBtn = document.getElementById('message-close-btn');
        const backdrop = document.getElementById('backdrop');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        
        // ---
        // Audio setup with Tone.js
        // Menggunakan Tone.js untuk menghasilkan audio secara programatik
        // ---

        // Tone.js instruments
        // Synth tunggal untuk efek suara
        const sfxSynth = new Tone.Synth().toDestination();

        // Fungsi untuk memulai/menghentikan loop
        function playButtonSfx() {
            sfxSynth.triggerAttackRelease("G4", "8n");
        }

        function playWhackSfx() {
            sfxSynth.triggerAttackRelease("C3", "16n");
        }

        // Variabel untuk melacak inisialisasi audio
        let audioInitiated = false;

        // Game variables
        let score = 0;
        let timeLeft = 30;
        let timerId = null;
        let moleTimerId = null;
        let lastHole;
        let gameActive = false;
        let gameLevel = 1; // 1: Mudah, 2: Normal, 3: Sulit
        let gameDuration = 30; // Detik
        let selectedAnimal = '🐭'; // Default animal
        let selectedHammer = 'hammer-cursor'; // Default hammer

        // Daftar pengaturan berdasarkan level
        const levelSettings = {
            '1': { minTime: 800, maxTime: 1200 },
            '2': { minTime: 600, maxTime: 1000 },
            '3': { minTime: 400, maxTime: 800 }
        };

        // Fungsi untuk menampilkan layar
        function showScreen(screen) {
            homeScreen.classList.add('hidden');
            settingsScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            screen.classList.remove('hidden');
        }

        // Fungsi untuk menampilkan kotak pesan
        function showMessage(title, content) {
            messageTitle.textContent = title;
            messageContent.textContent = content;
            messageBox.style.display = 'block';
            backdrop.style.display = 'block';
        }

        // Fungsi untuk menyembunyikan kotak pesan
        function hideMessage() {
            messageBox.style.display = 'none';
            backdrop.style.display = 'none';
        }

        // Fungsi untuk mengakhiri game dan menampilkan pesan
        function finishGame(title, content) {
            console.log('Game Selesai. Menampilkan notifikasi...');
            clearInterval(timerId);
            clearTimeout(moleTimerId);
            gameActive = false;
            resetGameBtn.classList.remove('hidden');
            document.querySelectorAll('.mole').forEach(mole => mole.remove());
            setCursorTheme('hammer-cursor');
            
            // Tambahkan suara kemenangan/kekalahan
            if (score >= 5) {
                sfxSynth.triggerAttackRelease("C4", "2n"); // Suara kemenangan
            } else {
                sfxSynth.triggerAttackRelease("C3", "4n"); // Suara kalah
            }
            
            showMessage(title, content);
        }

        // Fungsi untuk menghasilkan lubang acak
        function randomHole(holes) {
            const idx = Math.floor(Math.random() * holes.length);
            const hole = holes[idx];
            if (hole === lastHole) {
                return randomHole(holes);
            }
            lastHole = hole;
            return hole;
        }

        // Fungsi untuk menghasilkan waktu acak
        function randomTime() {
            const { minTime, maxTime } = levelSettings[gameLevel];
            return Math.random() * (maxTime - minTime) + minTime;
        }

        // Fungsi untuk memunculkan tikus tanah
        function popUpMole() {
            if (!gameActive) return;
            const holes = document.querySelectorAll('.hole');
            const hole = randomHole(holes);
            
            // Hapus tikus tanah yang ada sebelum membuat yang baru
            holes.forEach(h => h.innerHTML = '');
            
            const mole = document.createElement('div');
            mole.classList.add('mole', 'up');
            mole.innerHTML = selectedAnimal; // Menggunakan emoji hewan yang dipilih
            hole.appendChild(mole);
            
            // Hapus tikus tanah setelah animasi selesai
            setTimeout(() => {
                mole.classList.remove('up');
            }, 300);

            // Jika game masih aktif, jadwalkan tikus tanah berikutnya
            if (gameActive) {
                moleTimerId = setTimeout(popUpMole, randomTime());
            }
        }

        // Fungsi untuk memulai game
        function startGame() {
            score = 0;
            timeLeft = gameDuration;
            scoreDisplay.textContent = score;
            timeLeftDisplay.textContent = timeLeft;
            gameActive = true;
            resetGameBtn.classList.add('hidden');
            setCursorTheme(selectedHammer);

            // Hapus tikus tanah yang ada dari sesi sebelumnya
            document.querySelectorAll('.hole').forEach(h => h.innerHTML = '');

            // Mulai timer dan memunculkan tikus tanah
            timerId = setInterval(() => {
                timeLeft--;
                timeLeftDisplay.textContent = timeLeft;
                if (timeLeft <= 0) {
                    finishGame('Waktu Habis!', `Skor Anda adalah ${score}.`);
                }
            }, 1000);
            
            popUpMole();
        }
        
        // Fungsi saat tikus tanah dipukul
        function whackMole(e) {
            if (!gameActive || !e.target.classList.contains('mole')) return;
            score++;
            playWhackSfx();
            e.target.classList.remove('up');
            e.target.remove();
            scoreDisplay.textContent = score;
            
            // Logika baru: Periksa jika pemain menang
            if (score >= 5) {
                finishGame('Kamu Menang!', `Selamat! Anda berhasil memukul ${score} tikus tanah!`);
            }
        }

        function setCursorTheme(theme) {
            document.body.classList.remove('hammer-cursor', 'shoe-cursor');
            document.body.classList.add(theme);
        }
        
        // Event Listeners
        const allButtons = document.querySelectorAll('button');
        allButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                // Pastikan audio telah diinisialisasi sebelum memutar suara
                if (!audioInitiated) {
                    // Hanya inisialisasi Tone.js jika belum dilakukan
                    Tone.start().then(() => {
                        audioInitiated = true;
                        playButtonSfx();
                    });
                } else {
                    playButtonSfx();
                }
            });
        });

        startGameBtn.addEventListener('click', () => {
            showScreen(gameScreen);
            startGame();
        });
        
        showSettingsBtn.addEventListener('click', () => {
            gameLevelSelect.value = gameLevel;
            gameDurationInput.value = gameDuration;
            gameAnimalSelect.value = selectedAnimal;
            gameHammerSelect.value = selectedHammer;
            showScreen(settingsScreen);
        });
        
        saveSettingsBtn.addEventListener('click', () => {
            gameLevel = parseInt(gameLevelSelect.value);
            gameDuration = parseInt(gameDurationInput.value);
            selectedAnimal = gameAnimalSelect.value;
            selectedHammer = gameHammerSelect.value;
            setCursorTheme(selectedHammer);
            // Menghapus notifikasi pada halaman depan
            showScreen(homeScreen);
        });

        backToHomeBtn.addEventListener('click', () => {
            showScreen(homeScreen);
        });

        resetGameBtn.addEventListener('click', () => {
            startGame();
        });

        gameBoard.addEventListener('click', whackMole);
        
        messageCloseBtn.addEventListener('click', () => {
            hideMessage();
        });

        // Event listener untuk tombol "Kembali ke Menu"
        backToMenuBtn.addEventListener('click', () => {
            // Berhentikan game jika pemain kembali ke menu
            clearInterval(timerId);
            clearTimeout(moleTimerId);
            gameActive = false;
            showScreen(homeScreen);
        });

    </script>
</body>
</html>
